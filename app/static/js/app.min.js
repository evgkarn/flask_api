document.addEventListener("DOMContentLoaded",(function(){let e=document.querySelector("#carName"),t=document.querySelector("#carModel"),o=document.querySelector(".cityIp"),n=document.querySelector(".search-form"),a=String(window.location.href);async function l(){let t=await fetch("http://evgkarn.pythonanywhere.com/todo/api/v1.0/auto",{method:"GET"});cars=await t.json(),carsOption=[],carsOption.push(cars.auto.map(e=>`<option value='${e}'>${e} </option>`)),console.log(carsOption);for(let t=0;t<carsOption.length;t++)e.innerHTML+=carsOption[t]}async function r(){console.log(e.value);let o="http://evgkarn.pythonanywhere.com/todo/api/v1.0/auto/"+e.value,n=await fetch(o,{method:"GET"});carsModel=await n.json(),modelOption=[],modelOption.push(carsModel.model.map(e=>`<option value='${e}'>${e} </option>`));for(let e=0;e<modelOption.length;e++)t.innerHTML+=modelOption[e]}console.log(a.indexOf("&")),async function(){if(a.indexOf("&")>0){let e=a.split("?");e.shift(),e=e.join("").split("&");for(let t of e)t=t.split("="),"name"===t[0]?document.querySelector("#detailName").value=t[1]:"mark_auto"===t[0]?(await l(),document.querySelector("#carName").value=t[1]):"model_auto"===t[0]&&(await r(),document.querySelector("#carModel").value=t[1])}else l()}(),async function(){await fetch("http://free.ipwhois.io/json/?lang=ru",{method:"GET"}).then(e=>e.json()).then(e=>{o.innerHTML=e.city,console.log(e.city)})}(),e.addEventListener("change",e=>{t.innerHTML="Выберите модель",r()}),n.addEventListener("submit",e=>{e.preventDefault();let t=n.querySelector("#detailName").value,o=n.querySelector("#carName").value,a=n.querySelector("#carModel").value;window.location=`http://evgkarn.pythonanywhere.com/search?${t.length>1?"name="+t:""}\n\t\t${o.length>1?"&mark_auto ="+o:""}\n\t\t${a.length>1?"&model_auto ="+a:""}`});let c=document.querySelectorAll(".ads-info p");for(let e=0;e<c.length;e++)console.log(c[e]),c[e].innerText=""+c[e].textContent.substr(0,60)}));